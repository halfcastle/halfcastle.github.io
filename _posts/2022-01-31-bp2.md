---
layout: post
title: ☆Blog Post 2☆
---

## Initialize project
Create a folder, copy it to github, open it through github desktop so that all our work gets synchronized.
Open terminal. This will be the place where we enter commands to run our flask webapp.

I did this the stupid way, but you could actually just open terminal from your repository page on github desktop. 

```
conda activate PIC16B
cd Documents/Github/webdev/flasky
export FLASK_ENV=development
```
Here's a [link](https://github.com/halfcastle/webdev) to the github repo of the webapp.
(https://github.com/halfcastle/webdev)
In VS Code, initialize the main page to our webapp site:


```python
from flask import Flask, render_template, request, g
import sqlite3
#import all packages needed in this project
app = Flask(__name__)

@app.route("/")
def main():
    return render_template("main.html")
    #return "hi there"
```

enter
```
flask run
```
in the terminal to get the url to access our website.


# 1. Enable Submissions

Now let's make the actual **main.html** file!

{% raw %}
```html
<!doctype html>
<title>{% block title %}{% endblock %} - Message Bank</title>
<nav>
    <h1> Random Message Bank! </h1>
    <link rel="stylesheet" href = "{{url_for('static', filename = 'style.css')}}">
    <!-- <b>Navigation:</b> -->
    <ul>
        <li><a href="{{ url_for('submit') }}">Submit a message</a></li>
        <li><a href="{{ url_for('viewy') }}">View messages</a></li>
    </ul>
</nav>
<section class="content">
    <header>
      {% block header %}{% endblock %}
    </header>
    {% block content %}{% endblock %}
  </section>
```
{% endraw %}

Let's write the **submit.html** file, which extends from main.html. (Viewy will come at a later stage!)
The form tags allow users to enter information.

{% raw %}
```html
{% extends 'main.html' %}
<!--this section, once clicked, will become an extension of main-->
{% block header %}
  <h1>{% block title %}~Submit A Message~{% endblock %}</h1>
{% endblock %}

{% block content %}
  <form method="POST" enctype="multipart/form-data">
      <label for="message">Your message:</label>
      <input type="text" name="message" id="message">
      <!--creates a textbox-like place for users to enter info-->
      <br>
      <label for="name">Your name:   </label>
      <input type="text" name="name" id="name">
      <br>
      <!--submit button zukuri-->
      <input type="submit" value="Submit">
      <!--selects an input type "submit", creates the submit button-->
  </form>
  {% if thanks %}
  Thank you for entering a message:)
  {% endif %}
{% endblock %}
```
{% endraw %}

## Database management functions!

**1. get_message_db**

The get_message_db function handles the creation of a table of messages.


```python
def get_message_db():
  if 'message_db' not in g: #checks if the database is in the g attribute
    g.message_db = sqlite3.connect("messages_db.sqlite") #if not, connect to db
  cmd = "CREATE TABLE IF NOT EXISTS messages (id INT, handle TEXT, message TEXT)"
  #command kinda explains itself. creates table if it doesn't alr exist
  #include id, handle (name), and message columns
  cursor = g.message_db.cursor()
  cursor.execute(cmd)

  return g.message_db
```

**2. insert_message(request)**

This function inserts a user message into our message database.


```python
def insert_message(request):
  #obtain message from request
  messagey=request.form["message"]
  #obtain name from request
  namey=request.form["name"]
  #connect to database
  db=get_message_db()
  cursor = db.cursor()
  
  cursor.execute("SELECT COUNT(*) FROM messages;")
  row_n=cursor.fetchone()[0] + 1 
  #setting id number as 1+number of rows, then inserting new request into messages
  cursor.execute("INSERT INTO messages (id, message, handle) VALUES (?, ?, ?)", (row_n, messagey, namey))
  db.commit()
  db.close()
```

**3. the submit() function**

Using POST and GET methods to transmit and receive data from the page. 
In the POST case, we also need to call insert_message(request) to execute inserting the user's input.
Also include a thank-you note after a user submits something.


```python
@app.route('/submit/', methods=['POST', 'GET'])
#directs to "url/submit"
def submit():
  if request.method == 'GET':
    return render_template('submit.html')
  else:
    insert_message(request)
    return render_template("submit.html", thanks=True)
```

# 2. Viewing Random Submissions

**The random_messages(n) function**, which returns a collection of n random messages from our messages database


```python
def random_messages(n):
  db = get_message_db()
  cursor = db.cursor()
  #obtain how many messages we have in our db
  cursor.execute("SELECT COUNT(*) from messages")
  row_n=cursor.fetchone()[0]
  if n>row_n:
    n=row_n
  #sets n to the number of rows of messages if there are less messages than the specified n
  randMessages=cursor.execute(f"SELECT * FROM messages ORDER BY RANDOM() LIMIT {n}").fetchall()
  #select n random messages from database
  #code inspiration from stackoverflow link
  db.close()
  return randMessages
```

**The view.html file** to display our messages. It will also be an extension to our main page.

{% raw %}
```html
{% extends 'main.html' %}

{% block header %}
  <h1>{% block title %}~Some Cool Messages~{% endblock %}</h1>
{% endblock %}

{% block content %}
<ul>
    #For loop to go over messages: 
    #then extracting index 1 and 2 (name and message content)
    {% for Mes in messages %}
      <br>
        <b>{{Mes[1]}}</b>
        <br> 
        {{Mes[2]}}
        <br>
    {% endfor %}
</ul>
{% endblock %}
```
{% endraw %}

**The viewy() function**, which allows users to view a random set of n messages


```python
@app.route('/view/')
#directs to "url/view"
def viewy():
  display=random_messages(5)
  return render_template("view.html", messages=display)
```

# 3. Customize your App

I did this by changing fonts and colors on Dr. Chodrow's style.css file.

```css
html {
    font-family: "Didot", sans-serif;
    background: rgb(175, 176, 243);
    padding: 1rem;
}

body {
    max-width: 900px;
    margin: 0 auto;
}

h1 {
    color: rgb(0, 0, 0);
    font-family: "Gill Sans", sans-serif;
    margin: 1rem 0;
    text-align: center;
}

a {
    color: rgb(219, 106, 62);
    text-decoration: none;
}

hr {
    border: none;
    border-top: 1px solid lightgray;
}

nav {
    background: rgb(207, 244, 255);
    padding: 0 0.5rem;
    border-radius: 25px;
}

nav ul  {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
}

nav ul li a {
    display: block;
    padding: 0.5rem;
}

.content {
    padding: 0 1rem 1rem;
    background: rgb(225, 208, 245);
    border-radius: 25px;
    text-align: center;
}

.flash {
    text-align: center;
    margin: 1em 0;
    padding: 1em;
    background: #cae6f6;
    border: 1px solid #377ba8;
}
```

And we're done! Here are screencaps of what it looks like:
![screencap1.png](/images/screencap1.png)

This image demonstrates the submission page of the webapp.

![screencap2.png](/images/screencap2.png)

This image demonstrates the viewing page of the webapp.
